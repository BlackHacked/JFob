

# 目的
本文档依托基于知识图谱的智能诊修应用功能，针对智能诊修知识数据，详细展开说明数据源概述、图数据库与数据模型、知识数据处理方法等san个方面的内容，旨在阐明知识数据的结构与采集处理方法和流程，进而用于构建、优化与维护智能诊修知识图谱，确保其在实际应用中能够有效支持故障诊断与维修工作。此外，知识数据图化处理流程为知识的结构化提供了一种通用的框架，协助支撑复杂查询、深入分析与智能决策应用能力实现。


# 数据源概述
本章内容对于诊修知识数据的定义与分类进行阐述，将诊修知识数据划分为结构化数据与非结构化数据，并明确结构与非结构化数据定义。此外，详细说明数据源选择标准，诊修知识数据源的选择需满足可靠性、相关性与实时性需求。最终，对经过筛选的数据内容与结构进行说明。
## 知识数据定义与分类
本节内容针对长期积累的诊修知识数据进行定义与分类，将知识数据粗分为结构化与非结构化数据。
### 结构化数据
结构化数据是指在格式或模型中具有固定模式或有组织的数据，这些数据通常存储在传统的关系数据库中。结构化数据的特点是易于查询和分析，因为它们按列和行的方式组织，每列都有明确的数据类型与格式。通常涵盖软件系统关系型数据库中的表单、电子表格以及其他格式规范明确的数据。在结构化数据中，每个数据元素都拥有固定的类型和存储格式，这些元素按照明确的关系排列在表中，如列定义字段，行存储具体的数据记录。
### 非结构化数据
非结构化数据是指没有预定数据模型或不适合关系表格的数据。这类数据通常包括文本、图像、视频和音频文件。

## 数据源选择标准
本节阐明了诊修数据源的选择标准，数据源需要满足数据可靠性、相关性与实时性要求，为图数据库的长期维护提供理论依据。为满足诊修知识库需要，综合评判数据的可靠性、相关性与及时性三个方面的信息，最终选择故障码数据、维修指导手册、维修案例与维修培训材料四类数据作为诊修知识库的诊修数据源，此外，将产品物料清单（BoM）作为补充数据源，完善车辆与其零部件的从属关系。
### 可靠性
选取的数据源的可靠性是保证诊修知识库准确性的关键。故障码数据和维修手册等关键资料需经过质量控制确保其内容的正确性和稳定性。维修案例和培训材料的编写和审核则需由经验丰富的技术专家负责。这些专家不仅拥有丰富的行业经验，还需定期接受技术培训，确保知识和技能能够与汽车行业的发展同步。以上措施保障了资料的可靠性，确保知识基于实际维修经验和最新技术标准。
### 相关性
数据的相关性对于确保诊修知识库的实用性至关重要。选取的数据必须与目前的维修需求和车型技术密切相关，确保技术人员能够利用知识库解决实际问题。通过真实的维修场景提供实用解决方案，帮助技术人员提高工作效率和成功率。
### 实时性
数据更新的实时性是维持诊修知识库先进性与实用性的关键，伴随技术进步与时间推移，故障类型与维修技术不断更新迭代，诊修图知识库需要及时准确地反映技术趋势、诊修现存问题与发展趋势。因而，故障码数据、维修指导手册、维修案例与维修培训材料等四类数据需要定期更新，确保诊修知识库实时性，以期应用新型维修技术，应对新出现的故障类型。此外，产品物料清单也需保证实时性，定时更新，不应出现数据滞后问题，确保诊修知识库可以准确定位车辆零部件信息。


## 结构化数据源概述
经过筛选的结构化数据源包括产品物料清单与故障码信息。本节内容将针对以上两类数据的数据结构、数据内容展开阐述。
### 产品物料清单
详细列出了制造车辆所需的所有物料，包括组件、部件、零件等配置信息。物料清单指定了所需材料的数量与各部件之间的关系及其在整个制造过程中的具体位置和功能。产品物料清单的导入可以协助快速定位故障车辆各项配置，进而协助完成维修方案制定。
物料清单通常包含以下信息：
- 零件码：唯一标识一个特定零件的代码
- 零件名：描述零件的通用名称
- 版本：零件的设计与修订版本
- 状态：标明零件在设计流程中的状态
- 零部件类型：区分零部件层级
- 数量：指定生产该产品所需零件数量
- 单位：零件计量单位
- 位置：零件在产品中的具体位置
- 修改者：记录对物料清单进行最后修改的人员或部门。

### 故障码信息
故障码信息指汽车故障诊断代码（DTC）的详细信息表。表中信息包括在整个车辆故障排查和维修流程中从初步的故障检测到具体的维修步骤。故障码信息的导入提供了故障的模式信息，协助诊修流程高效完成。
故障码信息表通常包含以下内容：
- 序号：提供了故障代码的编号，方便查阅和引用。
- 车型配置：列出了不同车型和配置，指示该故障代码适用于哪些车辆。
- 控制器（ECU）名称和版本：显示了控制单元的名称和软件版本，有助于确定故障码对应的具体ECU。
- 故障码（DTC）：细分为高字节、中字节、低字节，以及失效类别和子类别，用十六进制表示。
- SPN：即Suspect Parameter Number，表示故障相关的参数编号。
- FMI：即Failure Mode Indicator，表示故障模式的指示器编号。
- 故障码描述：提供了诊断仪器和仪表盘上显示的故障码相关描述。
- 优先级：故障的紧急程度或处理优先级。
- 故障现象：描述故障时车辆出现的具体现象。
- 跛行方式：当这种故障发生时，车辆可能进入的安全模式或降级操作。
- 可能的原因：列举了导致该故障发生的可能原因。
- 冻结帧：提供了故障发生时的即时车辆运行数据。
- 故障产生和恢复策略：详细说明了故障产生的前提条件、监测阈值、监测时间或次数、监测类型和率，以及故障恢复的条件和所需时间或次数。
- 历史故障：包括未确认故障删除条件和故障确认及自愈的条件。
- 报警指示：包含故障码对应的报警灯（如MIL、SVS、ABS等）和点亮熄灭策略。
- 故障能否清除、是否限扭：指示是否可以通过诊断工具清除故障码，以及是否有扭矩限制。
- 通用诊断仪能否读取：标识通用诊断工具是否能够读取该故障码。
- 备注：提供了其他需要注意的信息。


## 非结构化数据源概述
经过筛选的非结构化数据源包括培训材料、维修案例和指导手册。本节内容将针对以上三类数据的数据结构、数据内容展开阐述。
### 培训材料
培训材料是指为技术人员提供必要的技能和知识教育的过程材料。这些材料包括故障诊断仪的使用说明、传感器的检测流程，以及其他相关设备的操作指南等，培训材料中的内容可能包括图表、步骤说明、案例研究和故障排除策略等。文档格式通常是由演示文稿转换为PDF格式，方便分发和查看。数据格式涵盖文本、图、表格等。
### 维修案例
维修案例是描述实际维修经验的文档，可以反映现实中的问题与复杂故障的解决策略。维修案例中详细记录了针对特定车型与配置的故障现象、处理思路、处理措施以及维修后的总结。文档格式通常由演示文档转换为pdf格式。内容数据类型包括文本、图、表格等。
### 指导手册
指导手册是指技术人员的操作指南和规程文件，内容涵盖维修任务的标准流程，为维修工作提供指导和参考。材料包括常见故障处理指导、技术指导与维修指导等。文档格式通常是pdf格式。内容数据类型包括文本、图、表格等。




# 图数据库与数据模型
为构建、优化与维护智能诊修能力，将引入图数据库进行数据存储与数据模型构建，本章内容将对于图数据库的特点、优势与数据模型进行详细说明。
## 图数据库的特点
传统的关系型数据库依赖于表和行的结构，当处理大量以及多关系数据查询时查询效率较低，并且表单模式通常是固定的，表单结构更改的需求将伴随大量复杂的数据迁移。图数据库的数据模型与结构用于描述与存储图形数据，具备数据之间的关联性（即拓扑关系）的处理能力。
图数据库的特点包括：
- 图表示法是一种直观且符合直觉的知识表现形式，使得在抽象化业务问题时，可以集中关注“业务问题本身”，而非“如何将问题转化为数据库的特定结构（如表格）”。
- 图形式表达可以更清晰地揭示数据间的连接特性，例如转账路径、相邻的社区等。
- 图查询语言专为图结构设计，提供了更为直观的数据访问方式。
综上，针对现实中的故障维修问题，由于其涉及的数据量大且类型繁多，图数据库提供了一种有效的解决方案。故障维修通常需要处理大量的设备数据、维修记录、零件信息以及这些元素之间的复杂关系，例如哪些零件常见于特定的故障类型，或者某种故障与特定操作条件之间的关联。在这样的场景中，图数据库能够有效地管理和查询这些复杂的关系。利用图数据库，可以直观地表示设备、零件和故障之间的关系，使得查询和分析更为直接和高效。


## 数据模型
数据模型是一种组织数据并说明它们如何相互关联的模型。图数据库数据模型使用 6 种基本的数据模型，包括图空间、点、边、标签、边类型与属性，本节内容将简明阐述数据模型的定义、用途与特点。
1. 图空间（Space）：图空间用于隔离不同团队或者项目的数据。不同图空间的数据是相互隔离的，可以指定不同的存储副本数、权限、分片等。
2. 点（Vertex）：点用来保存实体对象，点的特点包括：点用点标识符（ VID ）作为唯一标识； VID 在同一图空间中唯一；VID 是一个64位整型值，或者自定义固定长度的字符串；点可以有 0 到多个属性；属性用标签（tag）作为唯一标识。
3. 边（Edge）：边表示两个点之间的关系或行为，边的特点包括：边将四元组 <起始点的点标识符, 边类型, 边的排序权重（rank）, 终点的点标识符> 作为唯一标识，不存在边标识符；两点之间可以有多条边；边有方向，不存在无向边；一条边有且只有一个边类型（edge type）；一条边有且只有一个边排序值（rank），数据类型为64位整型，默认值为0。
4. 标签（tag）：由一组预先定义的属性构成。
5. 边类型（edge type）：由一组预先定义的属性构成。
6. 属性（Property）：以键值对形式表示的信息。
为保证数据一致性与结构完整性，本文所依托的智能诊修知识图谱应用采用强类型模式的数据模型。强类型模式数据模型强调在数据空间内，数据导入前需要严格定义其中实体与关系的类别属性。强类型模式的数据模型具备以下特点：
- 易于维护：明确定义的结构使得数据库更容易维护和升级。
- 易于理解：清晰定义的类型模式有助于理解数据模型的结构，提升跨团队的沟通效率。
- 结构明确：数据库设计阶段就定义出清晰的数据结构，包括节点和边的属性类型。这提高了数据的组织性和可查询性，同时也使得数据模型更加稳定。
- 数据完整：确保了数据输入时的完整性检查，避免了类型不一致和格式错误等数据问题，从而提高了数据质量。



# 知识数据处理方法
知识数据图化流程提供了一种将数据元素及其相互关系有效编码的方法。通过定义实体和关系的类型，以及它们之间的相互作用，创建可结构化复杂关系的高性能动态系统，在支持复杂数据查询的同时保证高性能，支撑高质、高效的数据管理能力搭建。

【插入总流程图】

## 数据预处理
本节内容将阐述在源数据的预处理阶段，结构化与非结构化数据的处理流程。

### 结构化数据预处理
当前结构化数据包括来源于物料管理系统的产品物料清单与来源于故障诊断仪的故障码信息表。数据格式是用于存储表格数据的纯文本格式csv。源表格数据中存在多种错误与冲突数据，数据预处理的目的去除重复记录、消除异常数据、修正错误数据、确保数据一致性。
1. 对于空值的处理：利用脚本将csv文档读取为更易操作处理的Data Frame格式，再进一步填充缺失值为指定内容，例如数字0。
2. 去除重复记录：利用脚本将csv文档读取为更易操作处理的Data Frame格式，移除任何完全重复的行。如果需要根据特定的列来判断重复性，通过修改参数指定列，完成重复性判断，移除重复记录。
3. 修正错误数据：利用脚本将csv文档读取为更易操作处理的Data Frame格式，为保证日期、时间与数值格式正确，将对应字符串转换为日期或数值类型。对于文本中错别字的纠正，利用纠正工具进行错误检测与修正。

### 非结构化数据预处理
非结构化数据源主要文档格式是包含文本、图片与表格的pdf格式。非结构化数据预处理目的是将多种格式的内容实体转换为便于后续处理的文本与表格格式。数据处理流程是首先将pdf格式的文档解析为不同格式的内容实体，内容实体类别包括文本、图片与表格。为保证后续图化流程中信息提取完整，在预处理过程中将针对图片与表格内容做进一步处理，提取文本信息或电子表格。为确保信息完整性，针对在图片、表格的文本提取过程中可能会出现的信息流失问题，对于包含关键信息的图片和表格源数据进行完整留存，以备后期查看。对于提取出的电子表格数据进行结构化数据处理，去除重复记录、消除异常数据、修正错误数据、确保数据一致性。
【插入处理流程图】
以下对于图片和表格的文本提取方法进行进一步说明：
- 图片信息提取： 利用OCR（光学字符识别）技术对于文本字符进行提取。最终输出为txt文本格式。
- 表格信息提取 ：首先定位PDF中的表格区域，扫描识别表格的边界和单元格，提取表格数据。再进一步将提取的数据被转换为结构化格式，通常以表格形式组织。随后，对提取的数据进行处理和清洗，以去除噪音和错误，例如空白行或不完整的单元格，以确保数据的准确性和完整性。最终生成一个包含提取的表格数据的csv格式的文件以供进一步处理。

## 数据的图化处理
经过对于源数据的预处理流程，当前数据包含两种类型：以txt格式存储的文本数据以及以csv格式存储的表格数据，本章内容将详细说明本文与表格数据的图化处理过程。
### 图结构设计
由于本文所依托的智能诊修知识图谱应用采用强类型模式的数据模型，强调在数据空间内，数据导入前需要严格定义其中实体与关系的类别属性。在进行实体、关系识别与数据导入之前根据应用需求，明确了图结构设计需求，基于设计需求定义了图数据结构。图结构设计如下图所示：
【插入图结构】
在以上图结构中定义了七个类型的实体与六个类型的关系，实体类型包括车辆、总成、部件、故障、故障现象、处理措施与维修技师，关系类型包括包含关系、发生故障关系、导致关系、拥有关系、出现关系、擅长关系。以下表格对实体与关系定义进行具体说明：
【插入实体与关系定义说明表格】

### 实体与关系识别
本节将根据文本和电子表格格式的数据，利用图结构设计，将数据内容映射到图结构中的实体和关系。为识别数据中的主体、属性以及它们之间的连接方式，需要对文本和电子表格中的数据进行分析和理解。此处将应用两种方法分析与理解数据，人工分析、基于大语言模型的实体与关系提取。以下内容将针对两种方法的应用流程进行展开说明。
#### 人工分析
在人工分析阶段，分析人员将依靠专业知识和经验，通过仔细阅读和理解文本以及电子表格数据来识别实体和关系。
1. 电子表格数据分析：对于电子表格数据，分析人员将审查不同列和行中的数据，识别出代表实体的各种属性，并尝试理解这些属性之间的关联。他们可能会查看特定的标识符或唯一值，以确定不同行或列中的实体，并考虑这些实体之间的可能联系。
2. 文本数据分析：由于时间成本较大，一般情况下不使用人工分析方式对文本数据进行分析理解。在少数情况下，比如大语言模型识别效果不佳等情况，分析人员将对文本数据进行深入阅读，识别出其中描述的各种实体，如车辆、总成、部件、故障、故障现象、处理措施和维修技师等。他们将着重关注文本中的名词性词语以及与之相关的修饰语或动词，以确定实体之间的关系。
3. 关系建模：一旦实体被确定，分析人员将尝试建立实体之间的关系模型。包括确定实体之间的直接关联，例如车辆与总成之间的包含关系。
4. 数据整合：将识别出的每一种实体和关系按图结构分别整理成csv格式的电子表格以便于图知识数据导入数据库。
5. 验证和反馈：引入其他专业人员进行验证，检查数据的准确性。这一步骤确保了数据的准确反映了实体和关系的实际情况。

#### 基于大语言模型的实体与关系提取（改）
在使用预训练的大语言模型进行实体与关系提取时，我们可以利用现有的自然语言处理技术来辨识和解释文本和电子表格数据中的实体和关系，而无需进行复杂的模型训练。这种方法依赖于已广泛训练的模型，以实现高效和准确的数据处理。
1. 实体识别：利用预训练模型对数据进行扫描，识别文中的关键实体，如车辆、总成、部件、故障等。模型已被训练以理解广泛的语言结构和词汇，因此可以准确标注文本中的实体名称和类别。
2. 关系提取：在识别出实体之后，利用模型分析实体之间的潜在关系。例如，模型可以识别部件和故障之间的“导致”关系，或是技师和特定维修措施之间的“擅长”关系。这些关系的提取依赖于模型对文本中上下文的理解。
3. 数据整合：将识别出的每一种实体和关系按图结构分别整理成csv格式的电子表格以便于图知识数据导入数据库。
4. 验证和反馈：引入专业人员进行验证，检查模型提取的数据的准确性。这一步骤确保了数据的准确反映了实体和关系的实际情况。

## 知识数据导入与管理
本节内容将阐述知识数据导入与管理的方法与过程。知识数据导入过程承接整理过的每种节点与关系的电子表格文档，经由图数据库连接与交互工具，通过 Python 语言编写脚本来管理和操作图数据库，将整理好的知识数据从电子表格文档中导入到图数据库中，从而支持后续的数据查询和分析活动。

### 导入工具与方法
图数据库连接与交互工具基于Python语言，该交互工具的功能包括直接管理和操作图数据，包括但不限于数据查询、更新、插入和删除。数据库连接池管理、会话自动化处理、结果转换，以及与多种数据可视化工具的集成。
利用交互工具实现知识数据导入首先需要通过配置并初始化连接池来确保与数据库的稳定连接。随后，通过从连接池中获取会话，导入节点与边的类型，由于数据库的设计模式为强类型模式，节点与边的类型导入过程需要在在节点与边批量导入之前。完成类型导入后，进行节点与边的批量导入。最终完成数据操作后，释放会话并最终关闭连接池以释放资源。