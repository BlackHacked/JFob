# 目的
本文档依托基于知识图谱的智能诊修应用功能，针对经由处理的智能诊修知识数据详细展开说明知识数据概述、技术要求概述、知识数据建模方法与知识数据建模测试与验证方法等四个方面的内容，依托经抽取处理的知识数据，在满足技术条件的前提下，依序搭建知识概念模型、逻辑模型与物理模型，确保图知识库的建立可以有效支撑知识应用需求。另外说明知识建模测试与验证方法，支撑知识模型的验证与迭代。根据图数据库技术要求，知识建模是图数据库存储与建立基于图数据库的应用功能的前提。同时，知识数据建模过程与业务需求紧密结合，确保知识库内容满足智能诊修功能需求。


# 知识数据概述
经过对于结构化与非结构化数据源



# 技术要求概述

本章内容说明了知识建模的技术要求，将技术要求从软件要求、硬件要求与网络要求三个方面展开说明，明确了部署图数据库，建立图知识模型的技术前提。
## 软件要求
1. 操作系统：当前仅支持在 Linux 系统中部署图数据库，建议在生产环境中使用内核版本为3.9 及以上版本的 Linux 系统。本项目使用Ubuntu 20.04系统，内核版本为5.15.0-94-generic。

## 硬件要求
1. 存储：建议使用固态硬盘，不建议使用远端存储设备，不支持磁盘阵列（RAID）。图数据库存储磁盘空间视数据规模而定，作为参考，估算点与边总数为两千万个，属性平均中文字符长度为150字时，需求存储空间为800G。本项目采用本地1TB存储空间的固态硬盘进行数据存储。
2. 内存：图数据库内存需根据应用需求进行调整，以优化性能和内存使用，最低要求为16GB内存，本项目硬件配置为64GB内存。
3. 处理器：CPU架构要求为x86_64，不支持ARM架构，CPU核数建议在4核以上。

## 网络要求
1. 带宽：高带宽网络连接，推荐 10Gbps 及以上带宽的网络，确保数据传输的效率。
2. 延迟：低延迟网络环境，推荐网络延迟低于 1 毫秒，确保数据查询和处理的响应速度。


# 知识数据建模
本章内容阐述知识数据建模的方法和流程，分为三个主要阶段：概念模型设计、逻辑模型设计和物理模型部署。概念模型设计阶段，明确知识数据条件与技术要求，根据业务现状和已知数据情况，定义关键实体与关系，确保业务需求和规则在模型中的完整实现。逻辑模型设计阶段，结合图数据库部署需求，在保障图数据库性能的前提下，将实体与关系映射为节点与边，详细说明模式设计与索引策略。物理模型部署阶段，描述图数据存储格式，确保图逻辑模型在图数据库中的实际部署。
[插入知识数据建模流程图]
## 概念模型设计
本节内容


### 图数据库概念模型概述
本节内容对于概念模型进行详细阐述，概念模型关注业务层面的概念和关系，依托智能诊修应用功能建设，承接诊修业务需求

### 关键实体与关系定义
- 关键实体和关系（如卡车、部件、维修、技师）
[插入概念模型图]

## 逻辑模型设计

- 图数据库逻辑模型概述
	- 逻辑模型设计则位于中间层次，更接近于具体的实现，但仍保持一定的抽象性，不涉及物理存储细节。
- 详细的模式设计
		- Tag/Edge type 预先定义了一组属性,建立 Tag（或者 Edge type）时，需要指定对应的属性。通常称为 Schema。
		- 一些图数据库产品是 schema-free 的设计，所以在数据模型上，不论是图拓扑结构还是属性，都可以非常自由。属性可以建模转变为图拓扑，反之亦然。这类系统通常对于图拓扑的访问有特别的优化。而 NebulaGraph 3.8.0 是强 Schema 的（行存型）系统，这意味着业务数据模型中的部分是“不应该经常改变的”，例如属性 Schema 应该避免改变。类似于 MySQL 中 ALTER TABLE 是应该尽量避免的操作。点及邻边可以非常低成本的增删，因此可以将业务模型中“经常改变的部分”建模成点或边（关系），而不是属性 Schema。例如，在一个业务模型中，人的属性是相对固定的，例如“年龄”，“性别”，“姓名”。而“通信好友”，“出入场所”，“交易账号”，“登录设备”等是相对容易改变的。前者适合建模为属性，后者适合建模为点或边。
	- 节点和边的定义
	- 每个节点和边的属性
		- 为边创建属性时请勿使用长文本：这些属性会被[存储 2 份](https://docs.nebula-graph.com.cn/3.8.0/1.introduction/3.nebula-graph-architecture/4.storage-service/)，导致写入放大问题（write amplification）。此时建议将长文本放在 HBase/ES 中，将其地址存放在 NebulaGraph 中。
	- 合理设置 Tag 属性：在图建模中，请将一组类似的平级属性放入同一个 Tag，即按不同概念进行分组。
- 索引策略
	- 使用属性索引可以通过属性查找到 VID。但是索引会导致写性能大幅下降，只有在根据点或边的属性定位点或边时才使用索引。


## 物理模型部署

### 图知识模型部署
根据

> 管理 Schema 信息：NebulaGraph 是强类型图数据库，它的 Schema 包括 Tag、Edge type、Tag 属性和 Edge type 属性。Meta 服务中存储了 Schema 信息，同时还负责 Schema 的添加、修改和删除，并记录它们的版本。




### 图数据存储
图存储的主要数据是点和边，NebulaGraph 将点和边的信息存储为 key，同时将点和边的属性信息存储在 value 中，以便更高效地使用属性过滤。
1. 点数据存储格式：*相比 NebulaGraph 2.x 版本，3.x 版本在开启**无 Tag** 的点配置后，每个点多了一个不含 TagID 字段并且无 value 的 key。*
![[Pasted image 20240521165736.png]]
![[Pasted image 20240521165631.png]]
`Type` ：key 类型。长度为 1 字节。
`PartID` ：数据分片编号。长度为 3 字节。此字段主要用于 Storage 负载均衡（balance）时方便根据前缀扫描整个分片的数据。
`VertexID` ：点 ID。当点 ID 类型为 int 时，长度为 8 字节；当点 ID 类型为 string 时，长度为创建图空间时指定的`fixed_string`长度。
`TagID` ：点关联的 Tag ID。长度为 4 字节。`SerializedValue`序列化的 value，用于保存点的属性信息。

2. 边数据存储格式
![[Pasted image 20240521170748.png]]
Type：key 类型。长度为 1 字节。
PartID：数据分片编号。长度为 3 字节。此字段主要用于 Storage 负载均衡（balance）时方便根据前缀扫描整个分片的数据。
VertexID：点 ID。前一个VertexID在出边里表示起始点 ID，在入边里表示目的点 ID；后一个VertexID出边里表示目的点 ID，在入边里表示起始点 ID。
Edge type：边的类型。大于 0 表示出边，小于 0 表示入边。长度为 4 字节。
Rank：用来处理两点之间有多个同类型边的情况。用户可以根据自己的需求进行设置，例如存放交易时间、交易流水号等。长度为 8 字节，
PlaceHolder：预留字段。长度为 1 字节。
SerializedValue：序列化的 value，用于保存边的属性信息。

3. 属性
>NebulaGraph 使用强类型 Schema。对于点或边的属性信息，NebulaGraph 会将属性信息编码后按顺序存储。由于定长属性的长度是固定的，查询时可以根据偏移量快速查询。在解码之前，需要先从 Meta 服务中查询具体的 Schema 信息（并缓存）。同时为了支持在线变更 Schema，在编码属性时，会加入对应的 Schema 版本信息。




- 建模优化
	- 



# 知识建模测试与验证方法
本章内容详细展开说明伴随技术与需求的变化，实现知识模型的

- 图数据库知识建模部署
- 测试策略和测试类型（单元测试、集成测试、性能测试）
- 确保数据完整性和准确性的验证方法


#### 附录

- 术语表
- 参考文献和资源
- 详细图表和附加材料